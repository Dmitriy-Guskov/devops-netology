Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"
1.	На лекции мы обсудили, что манипулировать размером окна необходимо для эффективного наполнения приемного буфера участников TCP сессии (Flow Control). Подобная проблема в полной мере возникает в сетях с высоким RTT. Например, если вы захотите передать 500 Гб бэкап из региона Юга-Восточной Азии на Восточное побережье США. Здесь вы можете увидеть и 200 и 400 мс вполне реального RTT. Подсчитайте, какого размера нужно окно TCP чтобы наполнить 1 Гбит/с канал при 300 мс RTT (берем простую ситуацию без потери пакетов). Можно воспользоваться готовым калькулятором. Ознакомиться с формулами, по которым работает калькулятор можно, например, на Wiki.

По формуле из вики получается:
rwin = rtt * throughput = 300мс * 1Гбит/с = 0.3с * 1Гбит/с = 0.3Гбит = 0,0375Гб

TCP throughput calculator
Theoretical network limit
rough estimation: rate < (MSS/RTT)*(C/sqrt(Loss)) [ C=1 ] (based on the Mathis et.al. formula)
network limit (MSS 1460 byte, RTT: 80.0 ms, Loss: 10-08 (10-06%)) : 1460.00 Mbit/sec.
Bandwidth-delay Product and buffer size
BDP (1000 Mbit/sec, 300.0 ms) = 37.50 Mbyte
required tcp buffer to reach 1000 Mbps with RTT of 300.0 ms >= 36621.1 KByte 
maximum throughput with a TCP window of 64 KByte and RTT of 300.0 ms <= 1.75 Mbit/sec.

2.	Во сколько раз упадет пропускная способность канала, если будет 1% потерь пакетов при передаче?

Померил iperf’ом:
без потерь получилолсь 2,09Гбит/с
с потерей 1% получилось 314Мбит/с
Итого имеем, что скорость упала в 6,5 раз

Посчитал калькулятором из П.1
Theoretical network limit
network limit (MSS 1460 byte, RTT: 2.0 ms, Loss: 10-08 (10-06%)) : 58400.00 Mbit/sec.
network limit (MSS 1460 byte, RTT: 2.0 ms, Loss: 1%) : 58.40 Mbit/sec.

UPD:

network limit (MSS 1460 byte, RTT: 200.0 ms, Loss: 10-08 (10-06%)) : 584.00 Mbit/sec.

network limit (MSS 1460 byte, RTT: 200.0 ms, Loss: 1%) : 0.58 Mbit/sec.

network limit (MSS 1460 byte, RTT: 300.0 ms, Loss: 10-08 (10-06%)) : 389.33 Mbit/sec.

network limit (MSS 1460 byte, RTT: 300.0 ms, Loss: 1%) : 0.39 Mbit/sec.




3.	Какая максимальная реальная скорость передачи данных достижима при линке 100 Мбит/с? Вопрос про TCP payload, то есть цифры, которые вы реально увидите в операционной системе в тестах или в браузере при скачивании файлов. Повлияет ли размер фрейма на это?
	

Ethernet header + IP header + TCP header + Ethernet trailer = 14+20+20+4=58
Application data – от 6 до 1460

|            | min | max  |
|------------|-----|------|
| служебные  | 58  | 58   |
| app data   | 6   | 1460 |
| итого      | 64  | 1518 |
| % app data | 9%  | 96%  |

Соответственно, по процентному отношению видно как размер фрейма app data относится к общему размеру пакета.  

4.	Что на самом деле происходит, когда вы открываете сайт? :) На прошлой лекции был приведен сокращенный вариант ответа на этот вопрос. Теперь вы знаете намного больше, в частности про IP адресацию, DNS и т.д. Опишите максимально подробно насколько вы это можете сделать, что происходит, когда вы делаете запрос curl -I http://netology.ru с вашей рабочей станции. Предположим, что arp кеш очищен, в локальном DNS нет закешированных записей.

- Разрешение IP:
	смотрим локальный кэш ДНС
	запрос на внешний ДНС, далее если нету рекурсивные запросы:
		Запрос на корневой ДНС . -> редирект на ru.
		Запрос на ru -> редрект на netology
		запрос на netology -> возврат IP
- Запрос соединения к хосту по порту 80 (SYN
- Подтверждение соединения SYN, ACK
- Запрос URL у сервера ACK + HTTP запрос
- Возврат ответа ACK + HTTP HEAD
- Подтверждение получения ACK
- Запрос на закрытие саодинения FIN
- Подтверждение закрытия FIN
- Подтверждение закрытия


UPD
ARP участвует! Очистил arp-таблицу и поймал запрос снифером:

vagrant@vagrant:~$ sudo tcpdump -i any arp -nn

tcpdump: verbose output suppressed, use -v or -vv for full protocol decode

listening on any, link-type LINUX_SLL (Linux cooked v1), capture size 262144 bytes

07:28:09.724176 ARP, Request who-has 10.0.2.3 tell 10.0.2.15, length 28

07:28:09.724325 ARP, Reply 10.0.2.3 is-at 52:54:00:12:35:03, length 46







5.	Сколько и каких итеративных запросов будет сделано при резолве домена www.google.co.uk?

1 Запрос на ДНС -> перенаправление на корневой ДНС
2 Корневой ДНС -> перенаправление на ДНС зоны UK
3 UK ДНС -> перенаправление на ДНС CO.UK
4 CO.UK ДНС -> перенаправление на ДНС GOOGLE.CO.UK
5 GOOGLE.CO.UK ДНС -> вернёт ip-адрес ДНС серверу из п.1


6.	Сколько доступно для назначения хостам адресов в подсети /25? А в подсети с маской 255.248.0.0. Постарайтесь потренироваться в ручных вычислениях чтобы немного набить руку, не пользоваться калькулятором сразу.

25 маска – 126 адресов 
255.248.0.0 – маска /13, 524286 адресов (255.248.0.0 - 1111 1111.1111 1000.0000 0000.0000 0000, (13+19), число адресов 2^19=524 288, 524 288 – 2 (зарезервированные служебные адресы) = 524 286)


7.	В какой подсети больше адресов, в /23 или /24?

Больше адресов в /23 (510 против 254 в /24)

8.	Получится ли разделить диапазон 10.0.0.0/8 на 128 подсетей по 131070 адресов в каждой? Какая маска будет у таких подсетей?

Получится. 128 подсетей с маской /15

Маска /8 – 16777216 (в т.ч. 2 служебных)
16777216/128=131072
131072 – это маска /15 (131070 адресов + 2 служебных)


