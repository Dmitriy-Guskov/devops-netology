Домашнее задание к занятию "3.6. Компьютерные сети, лекция 1"

1.	Необязательное задание: можно посмотреть целый фильм в консоли telnet towel.blinkenlights.nl :)

Не удалось, посмотрел на ютубе.


2.	Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе на 2.4 ГГц. Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный ответ и на этот вопрос.

https://habrastorage.org/r/w1560/getpro/habr/post_images/ccf/7c3/cd9/ccf7c3cd9495d0cab6e3de46174071fc.png

1-6-11 каналы не пересекаются (при ширине канала 20МГц), Если ширина канала 40МГц, то в диапазоне 2,4ГГц можно разместить только один широкополосный канал.

3.	Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC 38:f9:d3:55:55:79?


Яблоко!



4.	Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт, а TCP – 32 байта?

Из лекции: Размер полезных данных (payload) в одном сегменте (MTU минус заголовки TCP, минус заголовки IP)

следовательно 9001-20-32 = 8949


5.	Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети? Почему да или нет?

Комбинация флага SYN и FIN, устанавливаемого в заголовке TCP, является недопустимой и относится к категории комбинации недопустимого / ненормального флага, поскольку она требует как установления соединения (через SYN), так и прекращения соединения (через FIN).


6.	ss -ula sport = :53 на хосте имеет следующий вывод:

State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
Почему в State присутствует только UNCONN, и может ли там присутствовать, например, TIME-WAIT?


Т.к. ключик -u говорит, что мы смотрим на протокол UDP, думаю, что тайм-вэйт не может присутствовать. Тайм-вэйт – состояние, когда сокет отправил подтверждение о получении завершения соединения и ждёт подтверждение доставки, а UDP подтверждение доставки не умеет.



7.	Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении. Схема переходов состояния соединения вам в этом поможет.


                	  Client		Server

        	       Established		Established

	>> FIN		FIN WAIT 1	>	CLOSE WAIT

	<< FIN-ACC	FIN WAIT 2	>	CLOSE WAIT

	>> ACK		TIME WAIT	<	LAST ACK

			Closed			Closed





8.	TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения. Каким будет теоретическое максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше одного?

Максимальное число портов – 65535

Максимальное число соединений от одного клиента – 65535, 1 порт на каждого клиента и 65535 соединений. Итого 65535 клиентов и с каждым 65535 соединений.



9.	Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии  TIME-WAIT? Если да, то является ли она хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.

Может. Например, при частом соединении-отсоединении. Как видится мне – ситуация не хорошая и не плохая. Всё зависит от задачи. Если количество тайм-вэйт укладывается в бэйзлайн, почему бы и нет? Предположу, что  при большом количестве тайм-вэйт может возникнуть ситуация с нехваткой свободных портов или ресурсов.

10.	Чем особенно плоха фрагментация UDP относительно фрагментации TCP?

В UDP отсутствует механизм контроля доставки пакета, поэтому проблемой может стать приложение, не имеющее хороших механизмов контроля. Чувствительные к перегрузкам UDP-приложения могут «съесть» значительную часть пропускной способности канала со всеми вытекающими…  

upd
Если один из фрагментов не дойдет, то необходимо отправить весь пакет снова, 
но в UDP нет контроля ошибок, и как следствие информация не дойдет.
Могу предположить, что в телефонии при большой загрузке звонки могут не проходить, 
т.к. фрагменты больших пакетов теряются и следовательно данные не долетают до адресата, 
так же может возникать проблема в нагруженных сетях, когда переполняется буфер фрагментов на сетеобразующем оборудовании, что может привести к замедлению сети.
Не уверен, что ТСР лучше в этом плане, просто гарантирует доставку, а значит при некоторых событиях объем трафика будет меньше, т.к. не нужно отправлять пакеты снова и снова.

upd2
Вы пишите:
"Если один из фрагментов не дойдет, то необходимо отправить весь пакет снова..." - какой механизм протокола UDP за это отвечает?

Никакой, реализация может быть на стороне приложения

"Не уверен, что ТСР лучше в этом плане, просто гарантирует доставку, а значит при некоторых событиях объем трафика будет меньше, т.к. не нужно отправлять пакеты снова и снова." - в чём заключается "гарантия" со стороны TCP? Почему нужно пересылать меньше данных?

ТСР

Повторная передача потерянных сегментов и контроль скорости через механизм окон – да

Подтверждение доставки – да

В случае с UDP если в приложении реализован контроль получения информации оно может делать запросы снова и снова, пока не получит то что надо, это может привести к большому трафику. 

В случае с TCP – подтверждение доставки на уровне протокола.


upd3
*Мы не говорим о приложениях, а говорим только о сетевых протоколах. Как вы правильно указали - в UDP нет механизмов надёжности, что это означает для нашего случая?*

Для нашего случая это означает потерю информации


*"В случае с UDP если в приложении реализован контроль получения информации оно может делать запросы снова и снова, пока не получит то что надо, это может привести к большому трафику." - аналогично, мы говорим не о приложении, а о сетевом протоколе.*



Если вам интересны сети, то могу задать пару дополнительных вопросов по нашему обсуждению:
*1) какой протокол больше загрузит полосу пропускания при одинаковом объёме передаваемых полезных 
данных? UDP или TCP? Почему?*

TCP, у него заголовки намного больше, 160 против 32 бит, плюс необходимость обмена сегментами для сервисных операций (установление сессии)



*2) какой протокол больше загрузит сетевое устройство при максимальной загрузке канала? UDP или TCP? Почему?*

ТСР. Он более сложный и требует больше ресурсов, в случае с TCP присутствет необходимости обмена сегментами для сервисных операций.


*3) почему видео и аудио используют UDP? Что произошло бы в случае использования TCP и условий, указанных в задании 2, ДЗ "Компьютерные сети 2" (Во сколько раз упадет пропускная способность канала, если будет 1% потерь пакетов при передаче?)*


Потому что для видео или аудио не критична потеря пакетов, голос запнется, картинка с артефактом, плюс при одинаковой ширине канала по UDP пролезет больше, меньше нагрузка на сетеобразующее.

Померил пропускную способность iperf'ом
получилолсь 2,09Гбит/с 
с потерей 1% получилось 314Мбит/с
Итого имеем, что скорость упала в 6,5 раз




11.	Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.

Я бы использовал TCP, гарантированная доставка пакетов для событий критична(смотря каких событий конечно :) ). Например, из-за перегрузки сети можно потерять события.

SYSLOG поддерживает и UDP (514 порт) и TCP (1468 порт).

Имеет несколько недостатков:

Проблема согласованности – протокол не определяет способ форматирования событий;

Проблема безопасности – в сообщениях syslog отсутствует аутентификация;

Проблема с доставкой – при использовании UDP нет гарантий получения событий




12.	Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?

vagrant@vagrant:~$ sudo ss state listening -t -p –numeric

Recv-Q   Send-Q     Local Address:Port       Peer Address:Port   Process                                                     

0        4096             0.0.0.0:111             0.0.0.0:*       users:(("rpcbind",pid=555,fd=4),("systemd",pid=1,fd=35))   

0        4096       127.0.0.53%lo:53              0.0.0.0:*       users:(("systemd-resolve",pid=556,fd=13))                  

0        128              0.0.0.0:22              0.0.0.0:*       users:(("sshd",pid=807,fd=3))                              

0        4096                [::]:111                [::]:*       users:(("rpcbind",pid=555,fd=6),("systemd",pid=1,fd=37))   

0        128                 [::]:22                 [::]:*       users:(("sshd",pid=807,fd=4))               


Можно еще попробовать по каждому порту посмотреть:

vagrant@vagrant:~$ sudo lsof -ni :22

COMMAND  PID    USER   FD   TYPE DEVICE SIZE/OFF NODE NAME

sshd     807    root    3u  IPv4  24160      0t0  TCP *:ssh (LISTEN)

sshd     807    root    4u  IPv6  24162      0t0  TCP *:ssh (LISTEN)

sshd    1099    root    4u  IPv4  26492      0t0  TCP 10.0.2.15:ssh->10.0.2.2:54049 (ESTABLISHED)

sshd    1146 vagrant    4u  IPv4  26492      0t0  TCP 10.0.2.15:ssh->10.0.2.2:54049 (ESTABLISHED)




13.	Какой ключ нужно добавить в tcpdump, чтобы он начал выводить не только заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и шестнадцатиричном?

Опция -А вывод в тексте ASCII

sudo tcpdump -A -c 1

Опция –x вывод в HEX

sudo tcpdump -x -c 1

Опция -XX вывод HEX и ASCII

sudo tcpdump -XX -c 1




14.	Попробуйте собрать дамп трафика с помощью tcpdump на основном интерфейсе вашей виртуальной машины и посмотреть его через tshark или Wireshark (можно ограничить число пакетов -c 100). Встретились ли вам какие-то установленные флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется стандарт Ethernet, фреймы которого попали в ваш дамп? Можно ли где-то в дампе увидеть OUI?

Командой поймали 100 пакетов в файл:

sudo tcpdump -i eth0 -tttt -c 100 -w dump.pcap

Опущу пол часа страданий, чтобы из виртуалки Vagrand скопировать файл на хостовую машину:

vagrant scp default:/home/vagrant/dump.pcap /Users/derpanter/Downloads/dump.pcap


При разборе дампа встретился только один флаг - не фрагментировать (0 и 1)

3 бита:

    0 - зарезервиравано, всегда 0,

    1 - указывает на фрагментирование

    2 - указывает на конец фрагментированных пакетов



Ethernet называется Ethernet II


OUI увидел в заголовке Ethernet:

Destination: PcsCompu_e3:90:а5 (08:00:27:e3:90:а5)



